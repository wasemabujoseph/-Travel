<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¯Ø±Ø§Ø³ØªÙŠ â€” Course Section (ØªÙˆØ¬ÙŠÙ‡ÙŠ)</title>
  <meta name="description" content="Ø¯Ø±Ø§Ø³ØªÙŠ - Ù…Ù†ØµØ© Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø°Ø§ÙƒØ±Ø© Ù„Ù„Ø·Ù„Ø§Ø¨ (ØªÙˆØ¬ÙŠÙ‡ÙŠ) â€” Ù…ÙˆØ§Ø¯ØŒ Ù…ÙˆØ§Ø±Ø¯ØŒ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù…ØªØ­Ø§Ù†Ø§ØªØŒ Ø®Ø·Ø© Ù…Ø°Ø§ÙƒØ±Ø©."/>
  <style>
    /* ---------- Base (modern, professional) ---------- */
    :root{
      --bg:#f6f8fb; --card:#ffffff; --muted:#6b7280; --accent:#4f46e5;
      --accent-2:#06b6d4; --success:#16a34a; --danger:#ef4444;
      --glass: rgba(255,255,255,0.6);
      --radius:12px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Naskh Arabic";
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#ffffff);color:#0f172a}
    a{color:var(--accent);text-decoration:none}
    /* layout */
    .app{display:grid;grid-template-columns:320px 1fr;gap:20px;padding:22px;min-height:100vh}
    @media (max-width:900px){.app{grid-template-columns:1fr}}
    aside.sidebar{background:var(--card);padding:18px;border-radius:var(--radius);box-shadow:0 8px 30px rgba(15,23,42,0.06);height:calc(100vh - 44px);position:sticky;top:22px;overflow:auto}
    main{min-height:60vh}
    header.site-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .brand{display:flex;flex-direction:column}
    .brand h1{margin:0;font-size:20px}
    .brand p{margin:0;color:var(--muted);font-size:13px}
    .nav{margin-top:18px;display:flex;flex-direction:column;gap:8px}
    .nav a{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;color:inherit;background:transparent;border:1px solid transparent}
    .nav a.active{background:linear-gradient(90deg, rgba(79,70,229,0.08), rgba(6,182,212,0.03));border-color:rgba(79,70,229,0.12)}
    .small{font-size:12px;color:var(--muted)}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;border:none;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(79,70,229,0.1)}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.03);margin-bottom:12px}
    .flex{display:flex;gap:10px;align-items:center}
    input[type=text], input[type=date], textarea, select{width:100%;padding:10px;border-radius:10px;border:1px solid #eef2ff;background:#fbfdff}
    textarea{min-height:86px;resize:vertical}
    /* progress circle */
    .progress-wrap{display:flex;gap:12px;align-items:center}
    .progress-circle{width:88px;height:88px}
    .muted{color:var(--muted);font-size:13px}
    /* topics list */
    .topics{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .topic{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;border:1px solid #f1f5f9;background:#fbfdff}
    /* resources */
    .resources{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .resource{padding:8px;border-radius:8px;border:1px dashed #eef2ff;display:flex;justify-content:space-between;align-items:center}
    /* table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border:1px solid #f1f5f9;text-align:right}
    /* footer */
    footer{font-size:13px;color:var(--muted);margin-top:20px}
    /* print */
    @media print{
      body{background:#fff}
      aside.sidebar, .no-print{display:none}
      .app{grid-template-columns:1fr}
      .print-only{display:block}
    }
    .hidden{display:none}
    /* small UI niceties */
    .pill{padding:6px 10px;border-radius:999px;background:#eef2ff;color:var(--accent);font-size:13px}
    .tag{font-size:12px;padding:4px 8px;border-radius:8px;background:#f8fafc;color:var(--muted)}
    .danger{color:var(--danger)}
    /* top controls */
    .controls{display:flex;gap:8px;align-items:center}
    .upload{display:none}
  </style>
</head>
<body>
  <div class="app" id="app">
    <aside class="sidebar">
      <div class="site-top">
        <div class="brand">
          <h1 id="brandTitle">Ø¯Ø±Ø§Ø³ØªÙŠ</h1>
          <p id="brandSub">Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ§Ø¯ â€¢ ØªÙˆØ¬ÙŠÙ‡ÙŠ</p>
        </div>
        <div class="controls">
          <button class="btn" id="exportBtn">Export</button>
          <button class="btn ghost" id="importBtn">Import</button>
        </div>
      </div>

      <div style="margin-top:10px">
        <input id="searchBox" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø¯Ø© Ø£Ùˆ Ù…ÙˆØ¶ÙˆØ¹..." />
      </div>

      <nav class="nav" id="sidebarNav" style="margin-top:14px">
        <a href="#home" class="nav-link active" data-route="home">ğŸ  <span class="small">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© / Home</span></a>
        <a href="#subjects" class="nav-link" data-route="subjects">ğŸ“š <span class="small">Ø§Ù„Ù…ÙˆØ§Ø¯ / Subjects</span></a>
        <a href="#past-papers" class="nav-link" data-route="past-papers">ğŸ“ <span class="small">Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</span></a>
        <a href="#exam-tips" class="nav-link" data-route="exam-tips">ğŸ¯ <span class="small">Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†</span></a>
        <a href="#planner" class="nav-link" data-route="planner">ğŸ—“ï¸ <span class="small">Ø§Ù„Ø®Ø·Ø© / Planner</span></a>
        <a href="#resources" class="nav-link" data-route="resources">ğŸ“ <span class="small">Ø§Ù„Ù…ÙƒØªØ¨Ø© / Resources</span></a>
        <a href="#settings" class="nav-link" data-route="settings">âš™ï¸ <span class="small">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a>
      </nav>

      <div style="margin-top:14px">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="muted">Ø§Ù„Ø­Ø§Ù„Ø©</div>
              <div id="summaryProgress" style="font-weight:700">0 Ù…ÙˆØ§Ø¯ â€” 0% Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
            </div>
            <div>
              <button class="btn" id="addSubjectBtn">Ø£Ø¶Ù Ù…Ø§Ø¯Ø©</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div class="small">Ø§Ù„Ù„ØºØ©</div>
            <div>
              <button class="btn ghost" id="langToggle">English</button>
            </div>
          </div>
          <div class="muted" style="font-size:13px">ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (RTL/LTR)</div>
        </div>

        <div class="card">
          <div class="muted" style="margin-bottom:8px">Ù…ØµØ§Ø¯Ø± Ø³Ø±ÙŠØ¹Ø©</div>
          <div id="quickResources" class="resources"></div>
          <div style="margin-top:8px">
            <input id="quickTitle" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ±Ø¯ (Ù…Ø«Ø§Ù„: Ù…Ù„Ø®Øµ Ø§Ù„ÙØµÙ„ 1)"/>
            <input id="quickLink" type="text" placeholder="Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù" style="margin-top:8px"/>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn" id="addQuick">Ø£Ø¶Ù Ù…ÙˆØ±Ø¯</button>
              <button class="btn ghost" id="clearData">Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
          </div>
        </div>

      </div>

      <footer style="margin-top:14px">
        <div class="small">Ù…Ù„Ù Ø«Ø§Ø¨Øª â€” Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ (LocalStorage)</div>
        <div class="small" style="margin-top:8px">Ù„ØªØ´ØºÙŠÙ„ Ù…Ø²Ø§Ù…Ù†Ø© Ø³Ø­Ø§Ø¨ÙŠØ© â€” ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¥Ø¶Ø§ÙØ© Firebase.</div>
      </footer>
    </aside>

    <main>
      <!-- Home -->
      <section id="page-home" class="page card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø¯Ø±Ø§Ø³ØªÙŠ</h2>
            <div class="muted">ØªØ§Ø¨Ø¹ Ø¯Ø±ÙˆØ³ÙƒØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ØŒ Ø®Ø·Ø· Ù…Ø°Ø§ÙƒØ±ØªÙƒ â€” ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯.</div>
          </div>
          <div class="flex">
            <button class="btn" id="printMonthly">Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</button>
            <button class="btn ghost" id="openSubjects">Ø§Ø°Ù‡Ø¨ Ù„Ù„Ù…ÙˆØ§Ø¯</button>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 380px;gap:16px;margin-top:14px">
          <div>
            <div class="card">
              <h3 style="margin-top:0">Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</h3>
              <ul id="homeUpdates" style="margin:0;padding-left:18px;color:var(--muted)"></ul>
            </div>

            <div class="card" style="margin-top:12px">
              <h3 style="margin-top:0">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
              <div id="recentSubjects" class="resources"></div>
            </div>
          </div>

          <aside style="background:#fbfdff;padding:14px;border-radius:12px">
            <h4 style="margin:0">Ù†ØµØ§Ø¦Ø­ Ø³Ø±ÙŠØ¹Ø©</h4>
            <ol style="margin-top:10px;color:var(--muted)">
              <li>Ù‚Ø³Ù‘Ù… Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ø¹Ù„Ù‰ Ø¬Ù„Ø³Ø§Øª Ù‚ØµÙŠØ±Ø© (45â€“60 Ø¯Ù‚ÙŠÙ‚Ø©).</li>
              <li>Ø­Ù„ Ù†Ù…Ø§Ø°Ø¬ Ø³Ø§Ø¨Ù‚Ø© Ù„ØªÙ‚ÙˆÙŠØ© Ù…Ù‡Ø§Ø±Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª.</li>
              <li>Ø¯ÙˆÙ‘Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù ÙˆÙƒØ±Ø±Ù‡Ø§ Ø¨Ø§Ù†ØªØ¸Ø§Ù….</li>
            </ol>
          </aside>
        </div>
      </section>

      <!-- Subjects -->
      <section id="page-subjects" class="page hidden">
        <div class="card" style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">Ø§Ù„Ù…ÙˆØ§Ø¯</h2>
            <div class="muted">Ø£Ø¶Ù Ø§Ù„Ù…ÙˆØ§Ø¯ØŒ Ø§Ù†Ø´Ø¦ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ØŒ Ø£Ø±ÙÙ‚ Ù…Ù„ÙØ§Øª ÙˆÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª.</div>
          </div>
          <div class="flex">
            <input id="subjectFilter" type="text" placeholder="ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯..." />
            <button class="btn" id="exportSubjects">ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¯</button>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 420px;gap:16px;margin-top:12px">
          <div>
            <div id="subjectsList" class="card" style="padding:12px;min-height:300px"></div>
          </div>

          <aside class="card">
            <h3 style="margin-top:0">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ø¯Ø©</h3>
            <div id="subjectPanel" style="display:none">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <h4 id="panelTitle" style="margin:0">â€”</h4>
                  <div id="panelSubtitle" class="muted">Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹: 0</div>
                </div>
                <div class="progress-wrap">
                  <div id="panelProgressCircle" class="progress-circle"></div>
                </div>
              </div>

              <div style="margin-top:12px">
                <div style="display:flex;gap:8px">
                  <input id="newTopic" type="text" placeholder="Ø£Ø¶Ù Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ø§Ù„: Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ù†ÙˆÙˆÙŠØ©)"/>
                  <button class="btn" id="addTopic">Ø£Ø¶Ù</button>
                </div>

                <div class="topics" id="topicsList"></div>

                <hr style="margin:12px 0;border:none;border-top:1px solid #f1f5f9" />

                <h4 style="margin:0 0 8px 0">Ø±ÙˆØ§Ø¨Ø· ÙˆÙ…Ù„ÙØ§Øª</h4>
                <div style="display:flex;gap:8px">
                  <input id="resTitle" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ±Ø¯" />
                </div>
                <div style="display:flex;gap:8px;margin-top:8px">
                  <input id="resLink" type="text" placeholder="Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù" />
                  <button class="btn" id="addRes">Ø£Ø¶Ù Ù…ÙˆØ±Ø¯</button>
                </div>

                <div class="resources" id="resList"></div>

                <hr style="margin:12px 0;border:none;border-top:1px solid #f1f5f9" />
                <h4>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ùˆ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</h4>
                <textarea id="notesField" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ..."></textarea>
                <div style="display:flex;gap:8px;margin-top:8px">
                  <button class="btn" id="saveNotes">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
                  <button class="btn ghost" id="saveTargetDate">Ø­ÙØ¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù</button>
                </div>

                <div style="margin-top:10px">
                  <label class="small">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ù„Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                  <input id="targetDate" type="date"/>
                </div>
              </div>
            </div>
            <div id="noSubject" class="muted">Ø­Ø¯Ø¯ Ù…Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ùˆ Ø£Ù†Ø´Ø¦ Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©.</div>
          </aside>
        </div>
      </section>

      <!-- Past Papers -->
      <section id="page-past-papers" class="page hidden card">
        <h2 style="margin-top:0">Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª (Past Papers)</h2>
        <div id="pastPapersList"></div>
      </section>

      <!-- Exam Tips -->
      <section id="page-exam-tips" class="page hidden card">
        <h2 style="margin-top:0">Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†</h2>
        <div id="tipsGrid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px"></div>
      </section>

      <!-- Planner -->
      <section id="page-planner" class="page hidden card">
        <h2 style="margin-top:0">Ø®Ø·Ø© Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© ÙˆÙˆØ±Ù‚Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h2>
        <p class="muted">Ø§Ø·Ø¨Ø¹ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙƒÙ€ ÙˆØ±Ù‚Ø© A3 Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ©.</p>
        <div style="margin-top:12px">
          <table><thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th><th>ØªÙ…ØŸ</th><th>Ù…Ø±Ø§Ø¬Ø¹Ø©ØŸ</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead>
            <tbody id="plannerTable">
              <tr><td>ÙƒÙŠÙ…ÙŠØ§Ø¡</td><td>Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ù†ÙˆÙˆÙŠØ©</td><td>__</td><td>__</td><td>__</td></tr>
              <tr><td>Ø£Ø­ÙŠØ§Ø¡</td><td>Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹ØµØ¨ÙŠ</td><td>__</td><td>__</td><td>__</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Resources -->
      <section id="page-resources" class="page hidden card">
        <h2 style="margin-top:0">Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø¬Ù…Ù‘Ø¹Ø©</h2>
        <div id="resourcesGrid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px"></div>
      </section>

      <!-- Settings -->
      <section id="page-settings" class="page hidden card">
        <h2 style="margin-top:0">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
        <div class="muted">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§. ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¥Ø¶Ø§ÙØ© Ù…Ø²Ø§Ù…Ù†Ø© Firebase Ø¹Ø¨Ø± ØªØ¹ÙŠÙŠÙ† Ù…ÙØ§ØªÙŠØ­ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.</div>
        <div style="margin-top:12px">
          <div style="display:flex;gap:8px">
            <button class="btn" id="exportAll">ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
            <label class="pill">Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ: <input id="autosave" type="checkbox" checked style="margin-left:6px"/></label>
          </div>
        </div>
      </section>

      <footer class="no-print" style="margin-top:16px">
        <div class="muted">ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø³Ø·Ø© Ø¯Ø±Ø§Ø³ØªÙŠ â€” Ø§Ø­ÙØ¸ Ù…Ù„Ù <strong>index.html</strong> Ù„ØªØ´ØºÙŠÙ„Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø£Ùˆ Ø§Ø±ÙØ¹Ù‡ Ø¥Ù„Ù‰ GitHub Pages.</div>
      </footer>

      <!-- Hidden print sheet -->
      <section class="print-only hidden" id="printSheet" style="display:none">
        <h2>ØªÙ‚Ø±ÙŠØ± ØªÙ‚Ø¯Ù… Ø§Ù„Ù…ÙˆØ§Ø¯ â€“ Ø´Ù‡Ø±</h2>
        <div id="printTables"></div>
      </section>

    </main>
  </div>

  <!-- Import modal -->
  <div id="importModal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center">
    <div style="background:#fff;padding:16px;border-radius:12px;max-width:640px;width:100%">
      <h3 style="margin:0">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª (JSON)</h3>
      <p class="muted">Ø§Ù„ØµÙ‚ Ù…Ø­ØªÙˆÙ‰ JSON Ø§Ù„Ø°ÙŠ ØµØ¯Ø±ØªÙ‡ Ù…Ø³Ø¨Ù‚Ù‹Ø§ Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ù„Ù JSON</p>
      <textarea id="importData" style="width:100%;height:160px"></textarea>
      <div style="display:flex;gap:8px;margin-top:8px;justify-content:flex-end">
        <input type="file" id="importFile" accept=".json" />
        <button class="btn" id="doImport">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
        <button class="btn ghost" id="closeImport">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

  <script>
  /***********************
   * Single-file Study Web App
   * - Bilingual (ar/en) toggle
   * - LocalStorage persistence
   * - Pages routing via hash
   * - Subjects, topics, resources, notes
   * - Past papers, exam tips, planner templates
   ***********************/

  // ---------- Data: curated resources & tips (sample, editable) ----------
  const curatedResources = {
    "ÙƒÙŠÙ…ÙŠØ§Ø¡": {
      summary: "Ù…Ù„Ø®ØµØ§ØªØŒ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙˆÙ†Ù…Ø§Ø°Ø¬ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙƒÙŠÙ…ÙŠØ§Ø¡.",
      files: [
        { title: "Ù†Ù…Ø§Ø°Ø¬ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ØªÙˆØ¬ÙŠÙ‡ÙŠ - ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© (Ù…Ø«Ø§Ù„ PDF)", link: "https://moe.gov.jo/sites/default/files/9-1-2023.pdf" },
        { title: "Watad - Ø£Ø³Ø¦Ù„Ø© Ø³Ù†ÙˆØ§Øª Ø³Ø§Ø¨Ù‚Ø©", link: "https://watad.me" }
      ],
      videos: [
        { title: "Ø´Ø±Ø­ ØªÙˆØ§Ø²Ù† Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª - Ù…Ø«Ø§Ù„", link: "https://www.youtube.com/watch?v=ysz5S6PUM-U" }
      ]
    },
    "Ø£Ø­ÙŠØ§Ø¡": {
      summary: "Ù…Ù„Ø®ØµØ§Øª Ù„Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹ØµØ¨ÙŠØŒ Ø§Ù„ÙˆØ±Ø§Ø«Ø© ÙˆØ¨Ø§Ù‚ÙŠ ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø£Ø­ÙŠØ§Ø¡.",
      files: [
        { title: "Ù†Ù…Ø§Ø°Ø¬ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø£Ø­ÙŠØ§Ø¡ - ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ©", link: "https://moe.gov.jo" }
      ],
      videos: [
        { title: "Ø¯Ø±Ø³ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹ØµØ¨ÙŠ - Ù…Ø«Ø§Ù„", link: "https://www.youtube.com/watch?v=2Wwzmv9FF5E" }
      ]
    },
    "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù…ØªÙ‚Ø¯Ù…": {
      summary: "Ù‚ÙˆØ§Ø¹Ø¯ ÙˆØªÙ…Ø§Ø±ÙŠÙ† Ù…ØªÙ‚Ø¯Ù…Ø© (Conditional, Tenses).",
      files: [
        { title: "Conditional Sentences - cheat sheet", link: "https://sharifling.wordpress.com/wp-content/uploads/2019/03/the-conditional-sentence-in-english-and-arabic.pdf" }
      ],
      videos: [
        { title: "Conditional practice", link: "https://www.youtube.com/watch?v=BqrZIhnWw9U" }
      ]
    },
    "Ø§Ù„ÙˆØ²Ø§Ø±Ø© ÙˆØ§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©": {
      summary: "Ø¨ÙˆØ§Ø¨Ø§Øª ÙˆØ±ÙˆØ§Ø¨Ø· Ø±Ø³Ù…ÙŠØ© Ù…Ù† ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠØ©.",
      files: [
        { title: "Ø¨ÙˆØ§Ø¨Ø© ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© (Tawjihi)", link: "http://tawjihi.jo/" }
      ],
      videos: [
        { title: "Ù‚Ù†Ø§Ø© ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠØ©", link: "https://www.youtube.com" }
      ]
    }
  };

  const examTips = [
    {title: 'Ø®Ø·Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†', body: 'Ø®ØµØµ 3 Ø£Ø³Ø§Ø¨ÙŠØ¹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©: Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø©ØŒ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø­Ù„ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©ØŒ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø« Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹ÙŠÙØ©.'},
    {title: 'ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©', body: 'Ø§Ù‚Ø±Ø£ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¬ÙŠØ¯Ù‹Ø§ Ø£ÙˆÙ„Ù‹Ø§ØŒ Ø§Ø¨Ø¯Ø£ Ø¨Ù…Ø§ ØªØ¹Ø±ÙÙ‡ Ù„Ø±ÙØ¹ Ø§Ù„Ø«Ù‚Ø©ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¥Ù† Ø¨Ù‚ÙŠ ÙˆÙ‚Øª.'},
    {title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª', body: 'Ù‚Ø³Ù‘Ù… ÙˆÙ‚Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù†: Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø®ØµØµ Ù„Ù‡Ø§ ÙˆÙ‚ØªÙ‹Ø§ Ù…ØªÙ†Ø§Ø³Ø¨Ù‹Ø§.'},
    {title: 'Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©', body: 'Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (flashcards)ØŒ ÙˆØ¹Ù„Ù‘Ù… Ø²Ù…ÙŠÙ„Ù‹Ø§ Ù…Ø§ ØªØ¹Ù„Ù…ØªÙ‡ â€” Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙŠØ¹Ø²Ø² Ø§Ù„ØªØ°ÙƒØ±.'}
  ];

  // ---------- App state ----------
  const LS_KEY = 'diraasti_v2';
  let state = {
    subjects: [],            // array of {id,name,topics:[{id,title,done}],resources:[],notes,practice,target}
    quick: [],               // quick resources
    updates: [],
    lang: 'ar'
  };

  // helper
  const uid = (n=6) => 'id'+Math.random().toString(36).slice(2,2+n);

  // load/save
  function saveState(){
    localStorage.setItem(LS_KEY, JSON.stringify(state));
    updateSummary();
  }
  function loadState(){
    const v = localStorage.getItem(LS_KEY);
    if(v){ try{ state = JSON.parse(v); } catch(e){ console.error('parse err',e) } }
    // migrate safety
    state.subjects = state.subjects || [];
    state.quick = state.quick || [];
    state.updates = state.updates || [];
    state.lang = state.lang || 'ar';
  }

  // ---------- UI helpers ----------
  const $ = id => document.getElementById(id);
  function bySel(sel, root=document) { return root.querySelector(sel) }

  function setActiveRoute(route){
    document.querySelectorAll('.nav-link').forEach(a=>a.classList.toggle('active', a.dataset.route===route));
    document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
    const el = $('page-'+route.replace('/','-'));
    if(el) el.classList.remove('hidden');
    else $('page-home').classList.remove('hidden');
    // update document title small
    document.title = (route==='home' ? 'Ø¯Ø±Ø§Ø³ØªÙŠ' : route) + ' â€” Ø¯Ø±Ø§Ø³ØªÙŠ';
    window.scrollTo(0,0);
  }

  // ---------- rendering ----------
  function renderQuick(){
    const el = $('quickResources'); el.innerHTML='';
    if(state.quick.length===0){ el.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø±Ø¯ Ø³Ø±ÙŠØ¹Ø©</div>'; return; }
    state.quick.forEach(r=>{
      const d = document.createElement('div'); d.className='resource';
      d.innerHTML = `<div style="max-width:80%">${escapeHtml(r.title)}</div><div style="display:flex;gap:8px"><a href="${escapeAttr(r.link)}" target="_blank">ÙØªØ­</a><button data-id="${r.id}" class="btn ghost del-Q">Ø­Ø°Ù</button></div>`;
      el.appendChild(d);
    });
  }

  function renderSubjectsList(filter=''){
    const el = $('subjectsList'); el.innerHTML='';
    if(state.subjects.length===0){ el.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ø¨Ø¹Ø¯ â€” Ø£Ø¶Ù Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¨Ø¯Ø¡.</div>'; return; }
    state.subjects.filter(s=> s.name.includes(filter) || (s.topics||[]).some(t=>t.title.includes(filter))).forEach(s=>{
      const div = document.createElement('div'); div.className='subject';
      const done = (s.topics||[]).filter(t=>t.done).length; const total = (s.topics||[]).length;
      div.style.padding='10px'; div.style.borderRadius='10px'; div.style.marginBottom='8px'; div.style.background='#ffffff';
      div.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">${escapeHtml(s.name)}</div>
            <div class="muted" style="font-size:13px">${done} Ù…Ù† ${total} Ù…ÙˆØ¶ÙˆØ¹ Ù…ÙƒØªÙ…Ù„</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="btn open-sub" data-id="${s.id}">ÙØªØ­</button>
            <button class="btn ghost export-sub" data-id="${s.id}">ØªØµØ¯ÙŠØ±</button>
            <button class="btn" data-id="${s.id}" style="background:#ef4444" title="Ø­Ø°Ù">Ø­Ø°Ù</button>
          </div>
        </div>
      `;
      el.appendChild(div);
    });
  }

  function renderPanel(subjectId){
    const panel = $('subjectPanel'); const no = $('noSubject');
    if(!subjectId){ panel.style.display='none'; no.style.display='block'; return; }
    const s = state.subjects.find(x=>x.id===subjectId); if(!s) return;
    no.style.display='none'; panel.style.display='block';
    $('panelTitle').textContent = s.name;
    $('panelSubtitle').textContent = `Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹: ${s.topics.length || 0}`;
    // topics
    const topicsList = $('topicsList'); topicsList.innerHTML='';
    (s.topics||[]).forEach(t=>{
      const div = document.createElement('div'); div.className='topic';
      div.innerHTML = `<div style="display:flex;gap:10px;align-items:center"><input type="checkbox" data-sid="${s.id}" data-tid="${t.id}" ${t.done? 'checked':''} /> <div>${escapeHtml(t.title)}</div></div>
        <div style="display:flex;gap:8px"><button data-sid="${s.id}" data-tid="${t.id}" class="btn ghost del-topic">Ø­Ø°Ù</button></div>`;
      topicsList.appendChild(div);
    });
    // resources
    const resList = $('resList'); resList.innerHTML='';
    if((s.resources||[]).length===0) resList.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø±Ø¯ Ù„Ù„Ù…Ø§Ø¯Ø©</div>';
    (s.resources||[]).forEach(r=>{
      const el = document.createElement('div'); el.className='resource';
      el.innerHTML = `<div>${escapeHtml(r.title)}</div><div style="display:flex;gap:8px"><a href="${escapeAttr(r.link)}" target="_blank">ÙØªØ­</a><button data-sid="${s.id}" data-rid="${r.id}" class="btn ghost del-res">Ø­Ø°Ù</button></div>`;
      resList.appendChild(el);
    });
    // notes
    $('notesField').value = s.notes || '';
    $('targetDate').value = s.target || '';
    // progress circle
    const done = (s.topics||[]).filter(t=>t.done).length; const total = s.topics.length || 0;
    const pct = total ? Math.round(done/total*100) : 0;
    renderProgressCircle('panelProgressCircle', pct);
    // attach current subject id for actions
    $('subjectPanel').dataset.sid = s.id;
  }

  function renderRecent(){
    const r = $('recentSubjects'); r.innerHTML='';
    state.subjects.slice(0,6).forEach(s=>{
      const e = document.createElement('div'); e.className='resource'; e.style.padding='8px';
      e.innerHTML = `<div>${escapeHtml(s.name)}</div><div><button class="btn ghost open-sub" data-id="${s.id}">ÙØªØ­</button></div>`;
      r.appendChild(e);
    });
  }

  function renderHomeUpdates(){
    const el = $('homeUpdates'); el.innerHTML='';
    const up = state.updates.slice(Math.max(0,state.updates.length-6));
    if(up.length===0) el.innerHTML = '<li class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</li>';
    up.forEach(u=>{ const li = document.createElement('li'); li.textContent = u; el.appendChild(li) });
  }

  function renderPastPapers(){
    const el = $('pastPapersList'); el.innerHTML='';
    Object.keys(curatedResources).forEach(k=>{
      const c = curatedResources[k];
      const card = document.createElement('div'); card.className='card';
      let html = `<h3 style="margin-top:0">${escapeHtml(k)}</h3><div class="muted">${escapeHtml(c.summary)}</div>`;
      html += '<div style="margin-top:8px"><strong>Files:</strong><ul>';
      c.files.forEach(f=> html+= `<li><a href="${escapeAttr(f.link)}" target="_blank">${escapeHtml(f.title)}</a></li>`);
      html += '</ul></div>';
      html += '<div style="margin-top:6px"><strong>Videos:</strong><ul>';
      c.videos.forEach(v=> html+= `<li><a href="${escapeAttr(v.link)}" target="_blank">${escapeHtml(v.title)}</a></li>`);
      html += '</ul></div>';
      card.innerHTML = html;
      el.appendChild(card);
    });
  }

  function renderTips(){
    const el = $('tipsGrid'); el.innerHTML='';
    examTips.forEach(t=>{
      const d = document.createElement('div'); d.className='card';
      d.innerHTML = `<h4 style="margin:0">${escapeHtml(t.title)}</h4><p class="muted" style="margin-top:8px">${escapeHtml(t.body)}</p>`;
      el.appendChild(d);
    });
  }

  function renderResourcesGrid(){
    const el = $('resourcesGrid'); el.innerHTML='';
    Object.keys(curatedResources).forEach(k=>{
      const c = curatedResources[k];
      const d = document.createElement('div'); d.className='card';
      let html = `<h4>${escapeHtml(k)}</h4><div class="muted">${escapeHtml(c.summary)}</div>`;
      if(c.files && c.files.length){ html += '<div style="margin-top:8px"><strong>Ù…Ù„ÙØ§Øª</strong><ul>'; c.files.forEach(f=> html += `<li><a href="${escapeAttr(f.link)}" target="_blank">${escapeHtml(f.title)}</a></li>`); html += '</ul></div>'; }
      if(c.videos && c.videos.length){ html += '<div style="margin-top:8px"><strong>ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</strong><ul>'; c.videos.forEach(v=> html += `<li><a href="${escapeAttr(v.link)}" target="_blank">${escapeHtml(v.title)}</a></li>`); html += '</ul></div>'; }
      d.innerHTML = html;
      el.appendChild(d);
    });
  }

  function renderTipsGrid(){
    // planner example already static
  }

  function updateSummary(){
    const totalSubjects = state.subjects.length;
    let totalPct = 0;
    if(totalSubjects>0){
      let sumPct=0;
      state.subjects.forEach(s=>{
        const t = s.topics||[]; const total = t.length; const done = t.filter(x=>x.done).length;
        sumPct += total? (done/total*100) : 0;
      });
      totalPct = Math.round(sumPct / totalSubjects);
    }
    $('summaryProgress').textContent = `${totalSubjects} Ù…Ø§Ø¯Ø© â€” ${totalPct}% Ø¥Ø¬Ù…Ø§Ù„ÙŠ`;
  }

  // ---------- small utils ----------
  function escapeHtml(s){ if(s==null) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') }
  function escapeAttr(s){ if(!s) return ''; return String(s).replaceAll('"','&quot;') }

  // progress circle renderer
  function renderProgressCircle(containerId, pct){
    const c = $(containerId);
    const r = 36; const circ = 2*Math.PI*r; const dash = circ * (pct/100);
    c.innerHTML = `<svg viewBox="0 0 100 100" width="88" height="88" aria-hidden="true"><defs>
      <linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="${'#06b6d4'}"/><stop offset="1" stop-color="${'#4f46e5'}"/></linearGradient></defs>
      <circle cx="50" cy="50" r="${r}" fill="none" stroke="#eef2ff" stroke-width="10"></circle>
      <circle cx="50" cy="50" r="${r}" fill="none" stroke="url(#g)" stroke-width="10" stroke-dasharray="${dash} ${circ-dash}" stroke-linecap="round" transform="rotate(-90 50 50)"></circle>
      <text x="50" y="55" font-size="14" text-anchor="middle" fill="#0f172a">${pct}%</text></svg>`;
  }

  // ---------- actions ----------
  function addSubject(name){
    const s = { id: uid(8), name: name||('Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©'), topics: [], resources: [], notes: '', practice:0, target:null };
    state.subjects.unshift(s);
    state.updates.push(`Ø£Ø¶ÙŠÙØª Ù…Ø§Ø¯Ø©: ${s.name}`);
    saveState(); renderSubjectsList(); renderRecent(); renderHomeUpdates();
  }

  function deleteSubject(id){
    state.subjects = state.subjects.filter(s=>s.id!==id);
    state.updates.push(`Ø­ÙØ°ÙØª Ù…Ø§Ø¯Ø©`); saveState(); renderSubjectsList(); renderPanel(null); renderRecent();
  }

  function openSubject(id){
    // navigate to subjects page and render panel
    location.hash = '#subjects';
    setTimeout(()=>{ renderPanel(id); }, 50);
  }

  function exportState(){
    const data = JSON.stringify(state, null, 2);
    const blob = new Blob([data], {type:'application/json'}); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='diraasti_export.json'; a.click(); URL.revokeObjectURL(url);
  }

  function importState(json){
    try{
      const obj = typeof json === 'string' ? JSON.parse(json) : json;
      if(obj.subjects){ state = obj; saveState(); refreshAll(); alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª') }
      else { alert('ØªÙ†Ø³ÙŠÙ‚ ØºÙŠØ± ØµØ­ÙŠØ­') }
    }catch(e){ alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© JSON') }
  }

  function refreshAll(){
    renderQuick(); renderSubjectsList($('subjectFilter').value||''); renderRecent(); renderHomeUpdates(); renderPastPapers(); renderTips(); renderResourcesGrid(); updateSummary();
  }

  // ---------- events binding ----------
  function bindEvents(){
    // nav
    document.querySelectorAll('.nav-link').forEach(a=>{
      a.addEventListener('click', (e)=>{
        const r = a.dataset.route;
        setActiveRoute(r);
      });
    });
    // route on hash
    window.addEventListener('hashchange', ()=> {
      const h = location.hash.replace('#','') || 'home'; setActiveRoute(h);
    });

    $('addSubjectBtn').addEventListener('click', ()=> {
      const name = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©'); if(!name) return; addSubject(name); refreshAll();
    });
    $('openSubjects').addEventListener('click', ()=> location.hash='#subjects');

    $('addQuick').addEventListener('click', ()=> {
      const t = $('quickTitle').value.trim(); const l = $('quickLink').value.trim();
      if(!t||!l) return alert('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„'); state.quick.unshift({id:uid(6), title:t, link:l}); $('quickTitle').value=''; $('quickLink').value=''; saveState(); renderQuick();
    });

    $('exportBtn').addEventListener('click', exportState);
    $('exportAll').addEventListener('click', exportState);
    $('importBtn').addEventListener('click', ()=> $('importModal').style.display='flex');
    $('closeImport').addEventListener('click', ()=> $('importModal').style.display='none');
    $('doImport').addEventListener('click', ()=> {
      const v = $('importData').value.trim(); if(!v) return alert('Ø£Ø¯Ø®Ù„ JSON'); importState(v); $('importModal').style.display='none';
    });
    $('importFile').addEventListener('change', (e)=> {
      const f = e.target.files[0]; if(!f) return;
      const reader = new FileReader(); reader.onload = ()=> importState(reader.result); reader.readAsText(f);
    });

    // subject filter
    $('subjectFilter').addEventListener('input', ()=> renderSubjectsList($('subjectFilter').value.trim()));

    // subjects list delegates
    document.getElementById('subjectsList').addEventListener('click', (e)=>{
      if(e.target.classList.contains('open-sub')){ openSubject(e.target.dataset.id); renderPanel(e.target.dataset.id); }
      if(e.target.classList.contains('export-sub')){ const s = state.subjects.find(x=>x.id===e.target.dataset.id); if(!s) return; const blob = new Blob([JSON.stringify(s,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download = `${s.name}.json`; a.click(); URL.revokeObjectURL(url); }
      if(e.target.getAttribute('title') === 'Ø­Ø°Ù'){ if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ')){ deleteSubject(e.target.dataset.id); refreshAll(); } }
    });

    // subject panel actions
    $('addTopic').addEventListener('click', ()=> {
      const sid = $('subjectPanel').dataset.sid; if(!sid) return alert('Ø§Ø®ØªØ± Ù…Ø§Ø¯Ø©'); const title = $('newTopic').value.trim(); if(!title) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹');
      const s = state.subjects.find(x=>x.id===sid); s.topics.push({id:uid(6), title, done:false}); $('newTopic').value=''; saveState(); renderPanel(sid); renderSubjectsList();
    });

    // topics checkbox & delete (delegate)
    $('topicsList').addEventListener('change', (e)=>{
      const cb = e.target; if(cb.tagName !== 'INPUT') return;
      const sid = cb.dataset.sid; const tid = cb.dataset.tid;
      const s = state.subjects.find(x=>x.id===sid); const t = s.topics.find(x=>x.id===tid); t.done = !!cb.checked; saveState(); renderPanel(sid); renderSubjectsList();
    });
    $('topicsList').addEventListener('click', (e)=>{
      if(e.target.classList.contains('del-topic')){ const sid = e.target.dataset.sid; const tid = e.target.dataset.tid; const s = state.subjects.find(x=>x.id===sid); s.topics = s.topics.filter(x=>x.id!==tid); saveState(); renderPanel(sid); renderSubjectsList(); }
    });

    // add resource to subject
    $('addRes').addEventListener('click', ()=> {
      const sid = $('subjectPanel').dataset.sid; if(!sid) return alert('Ø§Ø®ØªØ± Ù…Ø§Ø¯Ø©'); const title = $('resTitle').value.trim(); const link = $('resLink').value.trim(); if(!title||!link) return alert('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„');
      const s = state.subjects.find(x=>x.id===sid); s.resources.push({id:uid(6), title, link}); $('resTitle').value=''; $('resLink').value=''; saveState(); renderPanel(sid);
    });

    // delete resource
    $('resList').addEventListener('click', (e)=>{
      if(e.target.classList.contains('del-res')){ const sid=e.target.dataset.sid; const rid=e.target.dataset.rid; const s=state.subjects.find(x=>x.id===sid); s.resources=s.resources.filter(r=>r.id!==rid); saveState(); renderPanel(sid); }
    });

    // notes save
    $('saveNotes').addEventListener('click', ()=>{
      const sid = $('subjectPanel').dataset.sid; if(!sid) return alert('Ø§Ø®ØªØ± Ù…Ø§Ø¯Ø©'); const s = state.subjects.find(x=>x.id===sid); s.notes = $('notesField').value; saveState(); alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª'); renderSubjectsList();
    });

    // delete quick resource
    $('quickResources').addEventListener('click', (e)=>{
      if(e.target.classList.contains('del-Q')){ const id=e.target.dataset.id; state.quick = state.quick.filter(x=>x.id!==id); saveState(); renderQuick(); }
    });

    // clear data (danger)
    $('clearData').addEventListener('click', ()=>{
      if(!confirm('Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©. Ù‡Ù„ ØªÙˆØ§ØµÙ„ØŸ')) return;
      state = { subjects: [], quick: [], updates: [], lang: state.lang || 'ar' }; saveState(); refreshAll();
    });

    // search
    $('searchBox').addEventListener('input', (e)=> {
      const q = e.target.value.trim();
      renderSubjectsList(q);
    });

    // print monthly
    $('printMonthly').addEventListener('click', ()=>{
      const sheet = $('printSheet'); const container = $('printTables'); container.innerHTML='';
      state.subjects.forEach(s=>{
        const trows = (s.topics||[]).map(t=>`<tr><td style="width:35%">${escapeHtml(t.title)}</td><td>${t.done? 'âœ…':'âŒ'}</td><td>${s.practice===2? 'âœ…': s.practice===1? 'ğŸ”': ''}</td><td>${s.resources && s.resources.length? 'ğŸ—‚ï¸' : ''}</td><td>${escapeHtml(s.notes||'')}</td></tr>`).join('');
        container.innerHTML += `<h3>${escapeHtml(s.name)}</h3><table style="width:100%;border-collapse:collapse"><thead style="background:#f1f5f9"><tr><th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th><th>ØªÙ…ØŸ</th><th>Ù…Ø±Ø§Ø¬Ø¹Ø©ØŸ</th><th>Ø­Ù„ØŸ</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead><tbody>${trows}</tbody></table><br/>`;
      });
      sheet.style.display='block'; window.print(); sheet.style.display='none';
    });

    // language toggle
    $('langToggle').addEventListener('click', ()=>{
      state.lang = (state.lang === 'ar') ? 'en' : 'ar';
      localStorage.setItem(LS_KEY, JSON.stringify(state));
      applyLanguage();
    });

    // import modal file (handled earlier)
    // export subjects quick
    $('exportSubjects').addEventListener('click', ()=> {
      const data = JSON.stringify({ subjects: state.subjects }, null, 2);
      const blob = new Blob([data], {type:'application/json'}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download = 'subjects.json'; a.click(); URL.revokeObjectURL(url);
    });

    // autosave checkbox
    $('autosave').addEventListener('change', (e)=> {
      // nothing complex here - saving always on actions; this toggles an indicator
      if(e.target.checked) state.updates.push('Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù„');
      else state.updates.push('Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ø·Ù‘Ù„');
      saveState(); renderHomeUpdates();
    });

    // import modal behavior: clicking background closes
    $('importModal').addEventListener('click', (e)=>{ if(e.target===$('importModal')) $('importModal').style.display='none'; });

  }

  // apply UI language (simple)
  function applyLanguage(){
    const L = state.lang || 'ar';
    // RTL if Arabic
    document.documentElement.dir = (L==='ar') ? 'rtl' : 'ltr';
    // change a few texts
    $('brandTitle').textContent = (L==='ar') ? 'Ø¯Ø±Ø§Ø³ØªÙŠ' : 'Diraasti';
    $('brandSub').textContent = (L==='ar') ? 'Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ§Ø¯ â€¢ ØªÙˆØ¬ÙŠÙ‡ÙŠ' : 'Course Section â€¢ Tawjihi';
    document.querySelectorAll('.nav-link').forEach(n=>{
      const r = n.dataset.route;
      if(L==='ar'){ // revert to Arabic labels
        const map = { home:'ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³Ù€ÙŠØ©', subjects:'ğŸ“š Ø§Ù„Ù…ÙˆØ§Ø¯', 'past-papers':'ğŸ“ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª', 'exam-tips':'ğŸ¯ Ù†ØµØ§Ø¦Ø­', planner:'ğŸ—“ï¸ Ø§Ù„Ø®Ø·Ø©', resources:'ğŸ“ Ø§Ù„Ù…ÙƒØªØ¨Ø©', settings:'âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' };
        n.querySelector('.small') ? n.querySelector('.small').textContent = (map[r] || r) : null;
      } else {
        const map = { home:'Home', subjects:'Subjects', 'past-papers':'Past Papers', 'exam-tips':'Exam Tips', planner:'Planner', resources:'Resources', settings:'Settings' };
        n.querySelector('.small') ? n.querySelector('.small').textContent = (map[r] || r) : null;
      }
    });
    $('langToggle').textContent = (L==='ar') ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
    // tiny other texts
    if(L==='en'){
      $('addSubjectBtn').textContent = 'Add Subject'; $('exportBtn').textContent='Export'; $('importBtn').textContent='Import';
    } else {
      $('addSubjectBtn').textContent = 'Ø£Ø¶Ù Ù…Ø§Ø¯Ø©'; $('exportBtn').textContent='Export'; $('importBtn').textContent='Import';
    }
    // save lang
    saveState();
  }

  // escapeAttr used in links
  function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;'); }

  // ---------- init ----------
  loadState(); bindEvents(); applyLanguage(); refreshAll(); setActiveRoute((location.hash||'#home').replace('#',''));

  // ensure sample seed if empty
  if(state.subjects.length===0){
    addSubject('ÙƒÙŠÙ…ÙŠØ§Ø¡'); addSubject('Ø£Ø­ÙŠØ§Ø¡'); addSubject('Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù…ØªÙ‚Ø¯Ù…');
    // populate some topics quickly
    state.subjects[0].topics.push({id:uid(5), title:'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ù†ÙˆÙˆÙŠØ©', done:true});
    state.subjects[0].topics.push({id:uid(5), title:'ØªÙˆØ§Ø²Ù† Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª', done:false});
    state.subjects[1].topics.push({id:uid(5), title:'Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹ØµØ¨ÙŠ', done:true});
    state.subjects[2].topics.push({id:uid(5), title:'Conditional Sentences', done:false});
    saveState(); refreshAll();
  }

  // expose for debugging
  window.Diraasti = { state, saveState, importState, exportState, addSubject };
  </script>
</body>
</html>
